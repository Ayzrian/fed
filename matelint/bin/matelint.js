"use strict";var e=require("path"),n=require("commander"),r=require("fs"),t=require("cosmiconfig"),o=require("parse5"),s=require("chalk");function l(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=l(e),a=l(r),c=l(s);const d={ignore:["node_module","dist"],rules:{"closing-and-opening-on-seme-level":!0}},u=(()=>{const e=t.cosmiconfigSync("matelint",{stopDir:process.cwd()}).search();return(null==e?void 0:e.config)||{}})(),g={...d,...u,ignore:(f=u.ignore||d.ignore,f.map((e=>new RegExp(e.replace(/\*\*/g,"[^/]+").replace(/\*/,"[^/]+\\"))))),rules:u.rules||d.rules};var f;const p=e=>{return n=e,g.ignore.some((e=>e.test(n)))?[]:a.default.statSync(e).isFile()?(r=e,".html"!==i.default.extname(r)?[]:[{path:r,content:a.default.readFileSync(r,"utf-8")}]):a.default.readdirSync(e).reduce(((n,r)=>[...n,...p(i.default.join(e,r))]),[]);var n,r};var m,h;!function(e){e.closingAndOpeningOnSemeLevel="closing-and-opening-on-seme-level"}(m||(m={})),function(e){e.Indent="Indent"}(h||(h={}));const v=[{id:m.closingAndOpeningOnSemeLevel,type:h.Indent,check({node:e}){const n=e.sourceCodeLocation;if(!n||!("startTag"in n))return null;const r=n.endTag?n.endTag.startCol:n.endCol-1;return n.startCol-r&&n.startLine!==n.endLine?{id:this.id,node:e,massage:"Tag’s closing bracket should be on the same level as opening one"}:null}}];class y{constructor(e){this.linter=e=>{const n=o.defaultTreeAdapter.isElementNode(e)?this.checker({node:e}):[];if("childNodes"in e){const r=e.childNodes.map(this.linter).flat();return[...n,...r]}return n},this.checker=((e,n)=>r=>e.flatMap((e=>e.check({...r,config:n}))).filter(Boolean))((e=>v.filter((n=>e.rules[n.id])))(e),e)}}const C={sourceCodeLocationInfo:!0},L=e=>{const n=new y(e);return e=>{const r=(t=e,o.parse(t,C));var t;return n.linter(r)}},k=require("table-layout"),q=e=>{if(0===e.errors.length)return;console.log(c.default.underline(e.path));const n=e.errors.map((e=>{if(!e)return null;const{massage:n,ruleId:r,startLine:t,startCol:o}=e;return{positions:c.default.gray(`${t}:${o}`),level:c.default.red("error"),massage:n,details:c.default.gray(`(${r})`)}})),r=new k(n,{noTrim:!0});console.log(r.toString())},w=e=>{const n=((e,n)=>{const r=L(n);return e.map((({path:e,content:n})=>({path:e,errors:r(n)})))})(p(e),g),r=n.map((({path:e,errors:n})=>({path:e,errors:n.map((e=>e&&(({massage:e,id:n,node:r})=>{var t,o;return{massage:e,ruleId:n,startLine:null===(t=r.sourceCodeLocation)||void 0===t?void 0:t.startLine,startCol:null===(o=r.sourceCodeLocation)||void 0===o?void 0:o.startCol}})(e)))})));(e=>{if(console.log(c.default.yellow("\n--- Mate: html linter ---\n")),0===e.length)return void console.log("html files not found\n");const n=e.reduce(((e,{errors:n})=>e+n.length),0);n>0?(e.forEach(q),console.log(c.default.red(`${n} ${n>1?"errors":"error"}`)),console.log(c.default.gray("https://mate-academy.github.io/fed/matelint/rules-description.html"))):console.log("✨✨ Your BEM is fine! ✨✨\n")})(r);n.some((({errors:e})=>e.length>0))?process.exit(1):process.exit(0)},S=new n.Command;S.name("matelint").version("0.1.0","-v --version","output current version"),S.option("[files...]").description("check code style in html").action(((e,n)=>w(i.default.join(process.cwd(),...n.args)))),S.parse(process.argv);
